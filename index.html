<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>U.S. Plumbing Access by State (1940-1990)</title>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  background: #f5f5f5;
  padding: 20px;
}
.container {
  max-width: 1200px;
  margin: 0 auto;
  background: white;
  border-radius: 12px;
  padding: 30px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
h1 {
  text-align: center;
  color: #333;
  margin-bottom: 10px;
  font-size: 2em;
}
.subtitle {
  text-align: center;
  color: #666;
  margin-bottom: 30px;
}
.controls {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin-bottom: 30px;
  flex-wrap: wrap;
}
.year-btn {
  padding: 12px 24px;
  border: none;
  background: #e5e7eb;
  color: #374151;
  border-radius: 8px;
  cursor: pointer;
  font-size: 16px;
  font-weight: 600;
  transition: all 0.3s;
}
.year-btn:hover {
  background: #d1d5db;
}
.year-btn.active {
  background: #dc2626;
  color: white;
  box-shadow: 0 4px 6px rgba(220, 38, 38, 0.3);
}
.stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}
.stat-card {
  background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
  padding: 20px;
  border-radius: 8px;
  text-align: center;
}
.stat-card:nth-child(2) {
  background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
}
.stat-card:nth-child(3) {
  background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
}
.stat-value {
  font-size: 36px;
  font-weight: bold;
  color: #dc2626;
}
.stat-card:nth-child(3) .stat-value {
  color: #16a34a;
}
.stat-label {
  font-size: 14px;
  color: #666;
  margin-top: 5px;
}
.map-container {
  position: relative;
  margin-bottom: 30px;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  overflow: hidden;
  background: #f9fafb;
}
.map-container svg {
  width: 100%;
  height: auto;
  display: block;
}
.tooltip {
  position: absolute;
  top: 20px;
  right: 20px;
  background: white;
  padding: 15px;
  border-radius: 8px;
  box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  border: 1px solid #e5e7eb;
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.2s;
  z-index: 10;
}
.tooltip.visible {
  opacity: 1;
}
.tooltip-state {
  font-weight: bold;
  font-size: 18px;
  margin-bottom: 5px;
}
.tooltip-value {
  font-size: 28px;
  font-weight: bold;
  color: #dc2626;
  margin-bottom: 5px;
}
.tooltip-label {
  font-size: 12px;
  color: #666;
}
.legend {
  border-top: 1px solid #e5e7eb;
  padding-top: 20px;
}
.legend h3 {
  text-align: center;
  margin-bottom: 15px;
  font-size: 18px;
  color: #333;
}
.legend-items {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  justify-content: center;
}
.legend-item {
  display: flex;
  align-items: center;
  gap: 8px;
}
.legend-box {
  width: 35px;
  height: 24px;
  border-radius: 4px;
  border: 1px solid #ccc;
}
.legend-label {
  font-size: 13px;
  color: #666;
}
path.state {
  stroke: #fff;
  stroke-width: 1.5;
  transition: opacity 0.2s;
  cursor: pointer;
}
path.state:hover {
  opacity: 0.8;
  stroke: #333;
  stroke-width: 2;
}
</style>
</head>
<body>
<div class="container">
  <h1>Lack of Complete Plumbing in U.S. Households</h1>
  <p class="subtitle">Percentage of housing units lacking complete plumbing facilities by state</p>
  
  <div class="controls">
    <button class="year-btn active" onclick="showYear('1940')">1940</button>
    <button class="year-btn" onclick="showYear('1950')">1950</button>
    <button class="year-btn" onclick="showYear('1960')">1960</button>
    <button class="year-btn" onclick="showYear('1970')">1970</button>
    <button class="year-btn" onclick="showYear('1980')">1980</button>
    <button class="year-btn" onclick="showYear('1990')">1990</button>
  </div>
  
  <div class="stats" id="stats"></div>
  
  <div class="map-container">
    <svg id="map" viewBox="0 0 960 600"></svg>
    <div class="tooltip" id="tooltip">
      <div class="tooltip-state" id="tooltipState"></div>
      <div class="tooltip-value" id="tooltipValue"></div>
      <div class="tooltip-label">lacking plumbing</div>
    </div>
  </div>
  
  <div class="legend">
    <h3>Color Legend</h3>
    <div class="legend-items">
      <div class="legend-item">
        <div class="legend-box" style="background: #fee5d9;"></div>
        <div class="legend-label">&lt; 1%</div>
      </div>
      <div class="legend-item">
        <div class="legend-box" style="background: #fcbba1;"></div>
        <div class="legend-label">1-2%</div>
      </div>
      <div class="legend-item">
        <div class="legend-box" style="background: #fc9272;"></div>
        <div class="legend-label">2-5%</div>
      </div>
      <div class="legend-item">
        <div class="legend-box" style="background: #fb6a4a;"></div>
        <div class="legend-label">5-10%</div>
      </div>
      <div class="legend-item">
        <div class="legend-box" style="background: #ef3b2c;"></div>
        <div class="legend-label">10-20%</div>
      </div>
      <div class="legend-item">
        <div class="legend-box" style="background: #cb181d;"></div>
        <div class="legend-label">20-40%</div>
      </div>
      <div class="legend-item">
        <div class="legend-box" style="background: #a50f15;"></div>
        <div class="legend-label">40-60%</div>
      </div>
      <div class="legend-item">
        <div class="legend-box" style="background: #67000d;"></div>
        <div class="legend-label">â‰¥ 60%</div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/3.0.2/topojson.min.js"></script>
<script>
const data = {
  '1940': {'AL':80.3,'AZ':53.5,'AR':83.5,'CA':16.6,'CO':53.7,'CT':18.8,'DE':40.3,'DC':17.7,'FL':46.2,'GA':76.3,'ID':61.6,'IL':36.2,'IN':54.4,'IA':58.2,'KS':60.1,'KY':73.8,'LA':67.2,'ME':55.0,'MD':39.5,'MA':17.3,'MI':37.5,'MN':54.5,'MS':86.0,'MO':57.0,'MT':63.1,'NE':57.7,'NV':43.7,'NH':39.2,'NJ':18.6,'NM':72.7,'NY':17.8,'NC':76.3,'ND':80.4,'OH':38.1,'OK':67.2,'OR':38.8,'PA':37.2,'RI':23.8,'SC':78.8,'SD':74.6,'TN':75.6,'TX':62.1,'UT':39.3,'VT':41.4,'VA':64.9,'WA':35.5,'WV':65.6,'WI':48.7,'WY':59.1,'AK':null,'HI':null},
  '1950': {'AL':67.8,'AK':null,'AZ':34.8,'AR':70.5,'CA':11.8,'CO':37.7,'CT':16.8,'DE':29.5,'DC':11.4,'FL':39.0,'GA':63.4,'HI':null,'ID':36.7,'IL':31.7,'IN':42.8,'IA':48.0,'KS':41.2,'KY':63.7,'LA':58.3,'ME':46.6,'MD':27.5,'MA':19.1,'MI':28.0,'MN':46.6,'MS':74.0,'MO':50.7,'MT':42.1,'NE':42.7,'NV':23.2,'NH':34.2,'NJ':14.9,'NM':47.5,'NY':14.0,'NC':64.8,'ND':65.9,'OH':28.9,'OK':47.0,'OR':23.9,'PA':26.9,'RI':37.1,'SC':65.1,'SD':61.3,'TN':63.3,'TX':45.4,'UT':18.4,'VT':33.1,'VA':49.6,'WA':19.1,'WV':53.9,'WI':40.8,'WY':38.1},
  '1960': {'AL':38.5,'AK':29.4,'AZ':13.4,'AR':43.2,'CA':5.1,'CO':14.1,'CT':7.3,'DE':12.4,'DC':7.7,'FL':15.0,'GA':33.7,'HI':16.8,'ID':14.7,'IL':13.4,'IN':17.3,'IA':19.8,'KS':15.9,'KY':39.7,'LA':29.5,'ME':30.5,'MD':10.5,'MA':9.6,'MI':11.7,'MN':22.1,'MS':47.8,'MO':25.9,'MT':20.4,'NE':17.5,'NV':9.8,'NH':16.7,'NJ':6.5,'NM':20.4,'NY':8.0,'NC':35.6,'ND':33.1,'OH':12.8,'OK':20.8,'OR':9.9,'PA':11.3,'RI':13.6,'SC':38.5,'SD':30.3,'TN':34.9,'TX':19.9,'UT':6.1,'VT':18.7,'VA':27.4,'WA':9.8,'WV':32.3,'WI':17.2,'WY':15.8},
  '1970': {'AL':16.9,'AK':17.2,'AZ':5.2,'AR':18.4,'CA':2.1,'CO':5.0,'CT':2.7,'DE':5.1,'DC':2.3,'FL':5.1,'GA':13.2,'HI':5.6,'ID':5.3,'IL':4.8,'IN':6.5,'IA':7.5,'KS':5.6,'KY':20.8,'LA':11.5,'ME':15.4,'MD':4.4,'MA':3.6,'MI':4.4,'MN':8.2,'MS':24.3,'MO':9.7,'MT':9.0,'NE':6.1,'NV':3.2,'NH':7.0,'NJ':2.5,'NM':10.6,'NY':3.2,'NC':15.6,'ND':13.8,'OH':5.2,'OK':7.1,'OR':3.6,'PA':5.1,'RI':3.1,'SC':18.6,'SD':13.6,'TN':14.8,'TX':7.7,'UT':2.7,'VT':8.4,'VA':13.4,'WA':3.4,'WV':18.3,'WI':7.2,'WY':5.9},
  '1980': {'AL':5.2,'AK':12.2,'AZ':2.6,'AR':5.3,'CA':1.4,'CO':1.8,'CT':1.4,'DE':2.0,'DC':2.4,'FL':1.2,'GA':3.8,'HI':2.3,'ID':2.0,'IL':2.0,'IN':2.1,'IA':2.4,'KS':2.0,'KY':7.5,'LA':3.1,'ME':5.8,'MD':2.1,'MA':1.7,'MI':1.8,'MN':2.8,'MS':7.2,'MO':3.0,'MT':3.4,'NE':1.9,'NV':1.4,'NH':2.9,'NJ':1.7,'NM':4.8,'NY':2.9,'NC':5.2,'ND':4.2,'OH':2.0,'OK':2.0,'OR':1.8,'PA':2.5,'RI':1.9,'SC':5.1,'SD':4.3,'TN':4.6,'TX':2.6,'UT':1.1,'VT':3.3,'VA':5.1,'WA':1.7,'WV':6.9,'WI':2.5,'WY':2.3},
  '1990': {'AL':1.6,'AK':12.5,'AZ':1.9,'AR':1.8,'CA':0.6,'CO':0.8,'CT':0.4,'DE':0.6,'DC':0.8,'FL':0.5,'GA':1.1,'HI':1.1,'ID':1.5,'IL':0.7,'IN':0.7,'IA':0.9,'KS':0.8,'KY':2.9,'LA':1.3,'ME':3.5,'MD':0.7,'MA':0.5,'MI':0.8,'MN':1.3,'MS':2.2,'MO':1.2,'MT':1.9,'NE':0.8,'NV':0.5,'NH':1.2,'NJ':0.5,'NM':3.2,'NY':0.9,'NC':1.5,'ND':2.0,'OH':0.8,'OK':1.0,'OR':0.9,'PA':1.0,'RI':0.5,'SC':1.4,'SD':2.0,'TN':1.6,'TX':1.2,'UT':1.0,'VT':2.3,'VA':1.8,'WA':0.9,'WV':3.2,'WI':1.4,'WY':1.6}
};

const nationalAverages = {
  '1940': 45.3,
  '1950': 35.5,
  '1960': 16.8,
  '1970': 6.9,
  '1980': 2.7,
  '1990': 1.1
};

const stateNameToAbbr = {
  'Alabama': 'AL', 'Alaska': 'AK', 'Arizona': 'AZ', 'Arkansas': 'AR', 'California': 'CA',
  'Colorado': 'CO', 'Connecticut': 'CT', 'Delaware': 'DE', 'Florida': 'FL', 'Georgia': 'GA',
  'Hawaii': 'HI', 'Idaho': 'ID', 'Illinois': 'IL', 'Indiana': 'IN', 'Iowa': 'IA',
  'Kansas': 'KS', 'Kentucky': 'KY', 'Louisiana': 'LA', 'Maine': 'ME', 'Maryland': 'MD',
  'Massachusetts': 'MA', 'Michigan': 'MI', 'Minnesota': 'MN', 'Mississippi': 'MS', 'Missouri': 'MO',
  'Montana': 'MT', 'Nebraska': 'NE', 'Nevada': 'NV', 'New Hampshire': 'NH', 'New Jersey': 'NJ',
  'New Mexico': 'NM', 'New York': 'NY', 'North Carolina': 'NC', 'North Dakota': 'ND', 'Ohio': 'OH',
  'Oklahoma': 'OK', 'Oregon': 'OR', 'Pennsylvania': 'PA', 'Rhode Island': 'RI', 'South Carolina': 'SC',
  'South Dakota': 'SD', 'Tennessee': 'TN', 'Texas': 'TX', 'Utah': 'UT', 'Vermont': 'VT',
  'Virginia': 'VA', 'Washington': 'WA', 'West Virginia': 'WV', 'Wisconsin': 'WI', 'Wyoming': 'WY',
  'District of Columbia': 'DC'
};

let currentYear = '1940';
let usData = null;

function getColor(pct) {
  if (pct >= 60) return '#67000d';
  if (pct >= 40) return '#a50f15';
  if (pct >= 20) return '#cb181d';
  if (pct >= 10) return '#ef3b2c';
  if (pct >= 5) return '#fb6a4a';
  if (pct >= 2) return '#fc9272';
  if (pct >= 1) return '#fcbba1';
  return '#fee5d9';
}

async function loadAndDrawMap() {
  // Load US map data
  const us = await d3.json('https://cdn.jsdelivr.net/npm/us-atlas@3/states-10m.json');
  usData = us;
  drawMap();
}

function drawMap() {
  const svg = d3.select('#map');
  svg.selectAll('*').remove();
  
  const width = 960;
  const height = 600;
  
  const projection = d3.geoAlbersUsa()
    .scale(1300)
    .translate([width / 2, height / 2]);
  
  const path = d3.geoPath().projection(projection);
  
  const yearData = data[currentYear];
  
  const states = topojson.feature(usData, usData.objects.states);
  
  svg.selectAll('path')
    .data(states.features)
    .enter()
    .append('path')
    .attr('d', path)
    .attr('class', 'state')
    .attr('fill', d => {
      const stateName = d.properties.name;
      const abbr = stateNameToAbbr[stateName];
      const pct = yearData[abbr];
      if (pct === null || pct === undefined) return '#e5e7eb';
      return getColor(pct);
    })
    .on('mouseenter', function(event, d) {
      const stateName = d.properties.name;
      const abbr = stateNameToAbbr[stateName];
      const pct = yearData[abbr];
      if (pct !== null && pct !== undefined) {
        showTooltip(abbr, pct);
      }
    })
    .on('mouseleave', hideTooltip);
}

function showTooltip(state, pct) {
  const tooltip = document.getElementById('tooltip');
  document.getElementById('tooltipState').textContent = state;
  document.getElementById('tooltipValue').textContent = pct + '%';
  tooltip.classList.add('visible');
}

function hideTooltip() {
  document.getElementById('tooltip').classList.remove('visible');
}

function showYear(year) {
  currentYear = year;
  document.querySelectorAll('.year-btn').forEach(btn => btn.classList.remove('active'));
  event.target.classList.add('active');
  
  drawMap();
  updateStats();
}

function updateStats() {
  const yearData = data[currentYear];
  const values = Object.values(yearData).filter(v => v !== null && v !== undefined);
  const avg = nationalAverages[currentYear];
  const max = Math.max(...values).toFixed(1);
  const min = Math.min(...values).toFixed(1);
  const maxState = Object.keys(yearData).find(k => yearData[k] === Math.max(...values));
  const minState = Object.keys(yearData).find(k => yearData[k] === Math.min(...values));
  
  document.getElementById('stats').innerHTML = `
    <div class="stat-card">
      <div class="stat-value">${avg}%</div>
      <div class="stat-label">National Average</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">${max}%</div>
      <div class="stat-label">Highest (${maxState})</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">${min}%</div>
      <div class="stat-label">Lowest (${minState})</div>
    </div>
  `;
}

loadAndDrawMap();
updateStats();
</script>
</body>
</html>
